# 1. MySQL의 전체 구조

### MySQL 엔진

요청된 SQL 문장을 분석하거나 최적화하는 등 DBMS의 두뇌에 해당하는 처리를 수행

- **Connection Handler** : 커넥션 및 쿼리 요청을 담당
- **SQL 인터페이스** : DML, DDL 등의 SQL 인터페이스 제공 담당
- **SQL 파서** : SQL 문법 오류 탐지 및 쿼리를 MySQL이 처리하기 좋게 파싱하는 작업 담당
- **SQL 옵티마이저** : 쿼리의 최적화된 실행 담당
- **캐시와 버퍼** : 성능 향상을 위한 보조 저상조 기능 담당

### MySQL 스토리지 엔진

실제 데이터를 디스크 스토리지에 저장하거나 디스크 스토리지로부터 데이터를 읽어오는 부분

- MySQL 엔진은 하나지만 스토리지 엔진은 여러개를 동시에 사용할 수 있다

### 핸들러 API

MySQL 엔진에서 데이터 쓰기 또는 읽기를 각 스토리지 엔진에 요청할 때 사용되는 API 

- `MySQL 엔진` -> `핸들러 API` -> `스토리지 엔진`

# 2. MySQL 스레딩 구조

MySQL 서버는 프로세스 기반이 아니라 스레드 기반으로 작동한다

### 포그라운드 스레드( == 사용자 스레드)

- 클라이언드가 요청한 쿼리 문장을 처리하는 스레드 → 커넥션 갯수 만큼 존재
- 데이터를 버퍼나 캐시 또는 직접 디스크가 인덱스 파일로 접근하여 가져옴
- 스레드 캐시에서 관리됨
    - 커넥션이 종료되면 해당 스레드는 스레드 캐시에 되돌아가게 된다
    - 이미 스레드 캐시에 일정 개수 이상의 대기 중인 스레드가 있으면 넣지 않고 종료시켜 일정 개수의 스레드만 캐시에 존재하게 한다
- 데이터를 버퍼나 캐시 또는 직접 디스크나 인덱스 파일로 접근하여 데이터를 가져옴

### 백그라운드 스레드

MyISAM 엔진의 경우에는 해당 사항이 없지만 InnoDB 엔진은 여러 가지 작업을 처리

- **Insert Buffer 를 병합하는 스레드**
- **로그를 디스크로 기록하는 스레드**
- InnoDB 버퍼 풀의 데이터를 디스크로 기록하는 스레드
- 데이터를 버퍼로 읽어들이는 스레드
- 잠금이나 데드락을 모니터링 하는 스레드

**특징**

- `InnoDB 엔진`는 쓰기 지연 작업(버퍼링)이 가능하며 해당 작업은 백그라운드 스레드가 실행하게 되어 데이터 변경이 일어나는 경우 디스크에 완전히 저장될 때까지 기다리지 않아도된다.
- 반면 `MyISAM 엔진`은 쓰기 지연 기능을 사용할 수 없으며 포그라운드 스레드가 실행하도록 설계되어있다.
